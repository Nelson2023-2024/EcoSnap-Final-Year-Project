generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  user_id            String          @id @default(uuid())
  user_firstName     String?
  user_lastName      String?
  user_fullName      String?
  user_email         String          @unique
  user_username      String          @unique
  user_phoneNumber   String?
  user_password      String?
  user_profileImage  String?         @default("https://cdn-icons-png.flaticon.com/512/149/149071.png")
  user_points        Int             @default(0)
  user_googleID      String?         @unique
  user_authProvider  String?
  user_role          UserRole        @default(user)
  user_createdAt     DateTime        @default(now())
  user_updatedAt     DateTime        @updatedAt
  user_assignedTeams TeamMember[]
  user_wasteReports  WasteAnalysis[]
  user_notifications Notification[]
  user_rewards       Reward[]
  user_orders        Order[]

  @@map("users")
}

model Team {
  team_id             String             @id @default(uuid())
  team_name           String
  team_url            String?
  team_specialization TeamSpecialization @default(general)
  team_status         TeamStatus         @default(active)
  team_createdAt      DateTime           @default(now())
  team_updatedAt      DateTime           @updatedAt
  team_members        TeamMember[]
  team_trucks         Truck[]
  team_dispatches     Dispatch[]

  @@map("teams")
}

model TeamMember {
  id     String @id @default(uuid())
  userId String
  teamId String
  team   Team   @relation(fields: [teamId], references: [team_id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [user_id], onDelete: Cascade)

  @@unique([userId, teamId])
  @@map("team_members")
}

model Truck {
  truck_id                 String      @id @default(uuid())
  truck_registrationNumber String      @unique
  truck_imageURL           String?
  truck_truckType          TruckType
  truck_capacity           Float
  truck_status             TruckStatus @default(available)
  truck_assignedTeamId     String?
  truck_locationLongitude  Float       @default(0)
  truck_locationLatitude   Float       @default(0)
  truck_createdAt          DateTime    @default(now())
  truck_updatedAt          DateTime    @updatedAt
  truck_assignedTeam       Team?       @relation(fields: [truck_assignedTeamId], references: [team_id])
  truck_dispatches         Dispatch[]

  @@map("trucks")
}

model WasteAnalysis {
  waste_id                   String                @id @default(uuid())
  waste_analysedBy           String
  waste_imageURL             String
  waste_containsWaste        Boolean               @default(true)
  waste_overallCategory      WasteOverallCategory?
  waste_dominantWasteType    String?
  waste_estimatedVolumeValue Float?
  waste_estimatedVolumeUnit  VolumeUnit?
  waste_possibleSource       String?               @db.Text
  waste_environmentalImpact  String?               @db.Text
  waste_confidenceLevel      String?
  waste_status               WasteStatus           @default(pending_dispatch)
  waste_errorMessage         String?               @db.Text
  waste_locationLongitude    Float
  waste_locationLatitude     Float
  waste_locationAddress      String?
  waste_createdAt            DateTime              @default(now())
  waste_updatedAt            DateTime              @updatedAt
  waste_wasteCategories      WasteCategory[]
  waste_user                 User                  @relation(fields: [waste_analysedBy], references: [user_id], onDelete: Cascade)
  waste_dispatch             Dispatch?

  @@map("waste_analysis")
}

model WasteCategory {
  id                        String        @id @default(uuid())
  waste_type                String
  waste_estimatedPercentage Float
  wasteAnalysisId           String
  wasteAnalysis             WasteAnalysis @relation(fields: [wasteAnalysisId], references: [waste_id], onDelete: Cascade)

  @@map("waste_categories")
}

model Dispatch {
  dispatch_id                   String         @id @default(uuid())
  dispatch_wasteAnalysisId      String         @unique
  dispatch_assignedTeamId       String
  dispatch_assignedTruckId      String
  dispatch_locationLongitude    Float
  dispatch_locationLatitude     Float
  dispatch_locationAddress      String?
  dispatch_status               DispatchStatus @default(assigned)
  dispatch_scheduledDate        DateTime
  dispatch_estimatedArrival     DateTime?
  dispatch_actualCollectionDate DateTime?
  dispatch_collectionVerified   Boolean        @default(false)
  dispatch_collectionNotes      String?        @db.Text
  dispatch_pointsAwarded        Int            @default(0)
  dispatch_priority             Priority       @default(normal)
  dispatch_createdAt            DateTime       @default(now())
  dispatch_updatedAt            DateTime       @updatedAt
  dispatch_wasteAnalysis        WasteAnalysis  @relation(fields: [dispatch_wasteAnalysisId], references: [waste_id], onDelete: Cascade)
  dispatch_assignedTeam         Team           @relation(fields: [dispatch_assignedTeamId], references: [team_id])
  dispatch_assignedTruck        Truck          @relation(fields: [dispatch_assignedTruckId], references: [truck_id])
  dispatch_collectionImages     DispatchImage[]

  @@map("dispatches")
}

model DispatchImage {
  id         String   @id @default(uuid())
  imageURL   String
  dispatchId String
  dispatch   Dispatch @relation(fields: [dispatchId], references: [dispatch_id], onDelete: Cascade)

  @@map("dispatch_images")
}

model Notification {
  notification_id         String             @id @default(uuid())
  notification_userId     String
  notification_type       NotificationType   @default(system)
  notification_title      String
  notification_message    String             @db.Text
  notification_entityType String?            // "waste_analysis", "dispatch", "order", "team", "truck", "reward", "product"
  notification_entityId   String?            // The ID of the related entity
  notification_isRead     Boolean            @default(false)
  notification_metadata   Json?
  notification_priority   Priority           @default(normal)
  notification_status     NotificationStatus @default(active)
  notification_createdAt  DateTime           @default(now())
  notification_updatedAt  DateTime           @updatedAt
  notification_user       User               @relation(fields: [notification_userId], references: [user_id], onDelete: Cascade)

  @@index([notification_userId, notification_isRead, notification_createdAt])
  @@index([notification_type, notification_status])
  @@index([notification_entityType, notification_entityId])
  @@map("notifications")
}

model Reward {
  reward_id              String          @id @default(uuid())
  reward_userId          String
  reward_wasteAnalysisId String?
  reward_pointsEarned    Int             @default(0)
  reward_reason          RewardReason    @default(waste_report)
  reward_transactionType TransactionType @default(credit)
  reward_createdAt       DateTime        @default(now())
  reward_updatedAt       DateTime        @updatedAt
  reward_user            User            @relation(fields: [reward_userId], references: [user_id], onDelete: Cascade)

  @@map("rewards")
}

model Product {
  product_id          String   @id @default(uuid())
  product_name        String
  product_description String?  @db.Text
  product_imageURL    String
  product_pointsCost  Int
  product_stock       Int      @default(0)
  product_isAvailable Boolean  @default(true)
  product_createdAt   DateTime @default(now())
  product_updatedAt   DateTime @updatedAt
  product_orders      Order[]

  @@map("products")
}

model Order {
  order_id        String      @id @default(uuid())
  order_userId    String
  order_productId String
  order_quantity  Int         @default(1)
  order_totalCost Int
  order_status    OrderStatus @default(pending)
  order_createdAt DateTime    @default(now())
  order_updatedAt DateTime    @updatedAt
  order_user      User        @relation(fields: [order_userId], references: [user_id], onDelete: Cascade)
  order_product   Product     @relation(fields: [order_productId], references: [product_id])

  @@map("orders")
}

enum UserRole {
  user
  admin
  collector
}

enum TeamSpecialization {
  general
  recyclables
  e_waste
  organic
  hazardous

  @@map("team_specialization")
}

enum TeamStatus {
  active
  off_duty

  @@map("team_status")
}

enum TruckType {
  general
  recyclables
  e_waste
  organic
  hazardous

  @@map("truck_type")
}

enum TruckStatus {
  available
  in_use
  maintenance

  @@map("truck_status")
}

enum WasteOverallCategory {
  general
  recyclables
  e_waste
  organic
  hazardous

  @@map("waste_overall_category")
}

enum VolumeUnit {
  kg
  liters
  cubic_meters

  @@map("volume_unit")
}

enum WasteStatus {
  pending_dispatch
  dispatched
  collected
  no_waste
  error

  @@map("waste_status")
}

enum DispatchStatus {
  pending
  assigned
  en_route
  collected
  completed
  cancelled

  @@map("dispatch_status")
}

enum Priority {
  low
  normal
  high
  urgent
}

enum NotificationType {
  login
  waste_report
  reward_earned
  bonus_awarded
  cleanup_verified
  dispatch_assigned
  dispatch_update
  truck_status
  team_update
  system
  order_status
  product_update

  @@map("notification_type")
}

enum NotificationStatus {
  active
  archived
  deleted

  @@map("notification_status")
}

enum RewardReason {
  waste_report
  cleanup_verified
  bonus
  redemption

  @@map("reward_reason")
}

enum TransactionType {
  credit
  debit

  @@map("transaction_type")
}

enum OrderStatus {
  pending
  confirmed
  shipped
  delivered
  cancelled

  @@map("order_status")
}